
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Sammba-MRI:Small mammals NeuroImaging in Python &#8212; Multimodal Imaging of Neurodegenerative Diseases and Therapies</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.3.2. sammba.registration.anats_to_template" href="sammba.registration.anats_to_template.html" />
    <link rel="prev" title="5.2.7. sammba.data_fetchers.fetch_lemur_mircen_2019_t2" href="sammba.data_fetchers.fetch_lemur_mircen_2019_t2.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="sammba-mri, neuroimaging, python, small animal, rodent, mouse, rat">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head><body>
<div id="logo-banner">
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../auto_examples/01_template/plot_register.html">Template creation</a></big>
    </li>
    <li>
      <small><a href="../auto_examples/02_preprocessing/plot_fmri_coregistration.html">fMRI preprocessing</a></small>
    </li>
    <li>
      <a href="../modules/reference.html#module-sammba.data_fetchers">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Sammba-MRI:</h1>
    <h2>Small mammals NeuroImaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="sammba.registration.anats_to_template.html" title="5.3.2. sammba.registration.anats_to_template"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sammba.data_fetchers.fetch_lemur_mircen_2019_t2.html" title="5.2.7. sammba.data_fetchers.fetch_lemur_mircen_2019_t2"
             accesskey="P">previous</a> |</li>
<li><a href="../index.html">Sammba-MRI Home</a> |&nbsp;</li>
<li><a href="../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="../reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../authors.html">About</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../reference.html" accesskey="U">5. sammba-MRI API Reference</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sammba.data_fetchers.fetch_lemur_mircen_2019_t2.html"
                        title="previous chapter">5.2.7. sammba.data_fetchers.fetch_lemur_mircen_2019_t2</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sammba.registration.anats_to_template.html"
                        title="next chapter">5.3.2. sammba.registration.anats_to_template</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page is a reference documentation. It only explains the
function signature, and not how to use it. Please refer to the
<a class="reference internal" href="../user_guide.html#user-guide"><span class="std std-ref">user guide</span></a> for the big picture.</p>
</div>
<div class="section" id="sammba-registration-anats-to-common">
<h1>5.3.1. sammba.registration.anats_to_common<a class="headerlink" href="#sammba-registration-anats-to-common" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="sammba.registration.anats_to_common">
<code class="sig-prename descclassname">sammba.registration.</code><code class="sig-name descname">anats_to_common</code><span class="sig-paren">(</span><em class="sig-param">anat_filenames, write_dir, brain_volume, registration_kind='affine', use_rats_tool=True, nonlinear_levels=[1, 2, 3], nonlinear_minimal_patches=[75], nonlinear_weight_file=None, convergence=0.005, blur_radius_coarse=1.1, caching=False, verbose=1, unifize_kwargs=None, brain_masking_unifize_kwargs=None</em><span class="sig-paren">)</span><a class="headerlink" href="#sammba.registration.anats_to_common" title="Permalink to this definition">¶</a></dt>
<dd><p>Create common template from native anatomical images and achieve
their registration to it.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>anat_filenames</strong> : list of str</p>
<blockquote>
<div><p>Paths to the anatomical images.</p>
</div></blockquote>
<p><strong>write_dir</strong> : str</p>
<blockquote>
<div><p>Path to an existant directory to save output files to.</p>
</div></blockquote>
<p><strong>brain_volume</strong> : int</p>
<blockquote>
<div><p>Volume of the brain in mm3 used for brain extraction.
Typically 400 for mouse and 1800 for rat.</p>
</div></blockquote>
<p><strong>registration_kind</strong> : one of {‘rigid’, ‘affine’, ‘nonlinear’}, optional</p>
<blockquote>
<div><p>The allowed transform kind.</p>
</div></blockquote>
<p><strong>use_rats_tool</strong> : bool, optional</p>
<blockquote>
<div><p>If True, brain mask is computed using RATS Mathematical Morphology.
Otherwise, a histogram-based brain segmentation is used.</p>
</div></blockquote>
<p><strong>nonlinear_levels</strong> : list of int, optional</p>
<blockquote>
<div><p>Maximal levels for each nonlinear warping iteration. Passed iteratively
to nipype.interfaces.afni.Qwarp</p>
</div></blockquote>
<p><strong>nonlinear_minimal_patches</strong> : list of int, optional</p>
<blockquote>
<div><p>Minimal patches for the final nonlinear warps, passed to
nipype.interfaces.afni.Qwarp</p>
</div></blockquote>
<p><strong>nonlinear_weight_file</strong> : str, optional</p>
<blockquote>
<div><p>Path to a mask used to weight non-linear registration. Ideally should 
include not just the whole brain but also extend in all directions to 
include some amount of surrounding head tissue.</p>
</div></blockquote>
<p><strong>convergence</strong> : float, optional</p>
<blockquote>
<div><p>Convergence limit, passed to nipype.interfaces.afni.Allineate</p>
</div></blockquote>
<p><strong>blur_radius_coarse</strong> : float, optional</p>
<blockquote>
<div><p>Radius passed to nipype.interfaces.afni.Allineate for
the “-twoblur” option</p>
</div></blockquote>
<p><strong>caching</strong> : bool, optional</p>
<blockquote>
<div><p>If True, caching is used for all the registration steps.</p>
</div></blockquote>
<p><strong>verbose</strong> : int, optional</p>
<blockquote>
<div><p>Verbosity level. Note that caching implies some
verbosity in any case.</p>
</div></blockquote>
<p><strong>unifize_kwargs</strong> : dict, optional</p>
<blockquote>
<div><p>Is passed to nipype.interfaces.afni.Unifize, to
control bias correction of the template.</p>
</div></blockquote>
<p><strong>brain_masking_unifize_kwargs</strong> : dict, optional</p>
<blockquote>
<div><p>Is passed to nipype.interfaces.afni.Unifize, to tune
the seperate bias correction step done prior to brain masking.</p>
</div></blockquote>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>data</strong> : sklearn.datasets.base.Bunch</p>
<blockquote>
<div><p>Dictionary-like object, the interest attributes are :</p>
<ul class="simple">
<li><dl class="simple">
<dt><cite>registered</cite><span class="classifier">list of str.</span></dt><dd><p>Paths to registered images. Note that
they have undergone a bias correction step before.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><cite>transforms</cite><span class="classifier">list of str.</span></dt><dd><p>Paths to the transforms from the raw
images to the registered images.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>nonlinear_weight_file:
Without this weight mask, for non-linear registration a mask is generated by 
binarizing the mean of images that have been brain and affine-registered, 
then evenly dilating it to include some surrounding head tissue. The 
non-linear registration is then weighted to work only within this mask. This 
substantially improves performance by 1) reducing the number of voxels to 
analyse, and 2) avoiding other parts of the head where structures are highly 
variable and signal often poor. However, this automatically-generated mask 
is frequently sub-optimal, usually due to missing paraflocculi and 
inappropriate dilation.</p>
<p>Of course, it is impossible to know ahead of time where to weight the image 
before the brains/heads have been registered to each other. So in practice a 
first running of this script is done up until and including the affine stage 
(the default). The user should then manually use 3dmask_tool or some other 
software tool to create an intersect/frac/union mask of the 
_Unifized_for_brain_extraction_masked_resample_shr_affine_catenated files. 
These can then be dilated as needed to include some surrounding head tissue 
(which helps to better distinguish the brain-non-brain boundary). Missing 
regions can be added manually. This does not have to be done precisely, only 
roughly, and it is better to include too much tissue than too little. The 
procedure should then be rerun as non-linear, but using this weight mask.                     
use_rats_tool:
If <cite>use_rats_tool</cite> is turned on, RATS tool is used for brain extraction
and has to be cited. For more information, see
<a class="reference external" href="http://www.iibi.uiowa.edu/content/rats-overview/">RATS</a></p>
</dd></dl>

<div style='clear:both'></div></div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; 2017, The sammba-MRI developers.
        <span style="padding-left: 5ex;">
          <a href="../_sources/generated/sammba.registration.anats_to_common.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>