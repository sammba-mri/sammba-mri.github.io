

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Registration to common space &mdash; Multimodal Imaging of Neurodegenerative Diseases and Therapies</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  

  
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Multimodal Imaging of Neurodegenerative Diseases and Therapies" href="../../index.html"/>
        <link rel="up" title="Gallery of Examples" href="../index.html"/>
        <link rel="next" title="Functional and anatomical coregistration" href="../02_preprocessing/plot_fmri_coregistration.html"/>
        <link rel="prev" title="Gallery of Examples" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> sammba-MRI
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Giving credit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">User guide: table of contents</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Gallery of Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#template-creation">Template creation</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Registration to common space</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#retrieve-the-data">Retrieve the data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-the-writing-directory">Define the writing directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#affine-registration">Affine registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visalize-results">Visalize results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualize-pipeline-steps">Visualize pipeline steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#fmri-spatial-preprocessing">fMRI spatial preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#functional-connectivity">Functional connectivity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference.html">sammba-MRI API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">sammba-MRI</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Gallery of Examples</a> &raquo;</li>
        
      <li>Registration to common space</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="registration-to-common-space">
<span id="sphx-glr-auto-examples-01-template-plot-register-py"></span><h1>Registration to common space<a class="headerlink" href="#registration-to-common-space" title="Permalink to this headline">¶</a></h1>
<p>Here we show how to create a template from multiple anatomical scans and
register all of them to it.
Initially, registration is of extracted brains. Once these are reasonably
aligned, whole heads are registered, weighted by masks that, if parameters
are chosen well, include some scalp. The amount of scalp is hopefully enough
to help in differentiating the brain-scalp boundary without including so much
head tissue that it starts to contaminate the registration with the highly
variable head tissue.</p>
<div class="section" id="retrieve-the-data">
<h2>Retrieve the data<a class="headerlink" href="#retrieve-the-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba</span> <span class="kn">import</span> <span class="n">data_fetchers</span>

<span class="n">retest</span> <span class="o">=</span> <span class="n">data_fetchers</span><span class="o">.</span><span class="n">fetch_zurich_test_retest</span><span class="p">(</span><span class="n">subjects</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                                                <span class="n">correct_headers</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>retest contains paths to images and data description</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">retest</span><span class="o">.</span><span class="n">anat</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;/home/salma/nilearn_data/zurich_retest/baseline/1366/3DRARE_corrected.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/nilearn_data/zurich_retest/baseline/1367/3DRARE_corrected.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/nilearn_data/zurich_retest/baseline/1368/3DRARE_corrected.nii.gz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-writing-directory">
<h2>Define the writing directory<a class="headerlink" href="#define-the-writing-directory" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">write_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;zurich_common&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">write_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">write_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="affine-registration">
<h2>Affine registration<a class="headerlink" href="#affine-registration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba.registration</span> <span class="kn">import</span> <a href="../../generated/sammba.registration.anats_to_common.html#sammba.registration.anats_to_common" class="sphx-glr-code-links" tooltip="Link to documentation for sammba.registration.anats_to_common"><span class="n">anats_to_common</span></a>

<span class="n">affine_register</span> <span class="o">=</span> <a href="../../generated/sammba.registration.anats_to_common.html#sammba.registration.anats_to_common" class="sphx-glr-code-links" tooltip="Link to documentation for sammba.registration.anats_to_common"><span class="n">anats_to_common</span></a><span class="p">(</span><span class="n">retest</span><span class="o">.</span><span class="n">anat</span><span class="p">,</span> <span class="n">write_dir</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">caching</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We set caching to True, so that this step computations are not restarted.
The paths to the registered images can be accessed easilly</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">registered_anats</span> <span class="o">=</span> <span class="n">affine_register</span><span class="o">.</span><span class="n">registered</span>
<span class="k">print</span><span class="p">(</span><span class="n">registered_anats</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/zurich_common/3DRARE_corrected_0_generated_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/zurich_common/3DRARE_corrected_1_generated_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/zurich_common/3DRARE_corrected_2_generated_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="visalize-results">
<h2>Visalize results<a class="headerlink" href="#visalize-results" title="Permalink to this headline">¶</a></h2>
<p>We plot the edges of one individual anat on top of the average image</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">image</span>

<span class="n">average_img</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.mean_img.html#nilearn.image.mean_img" class="sphx-glr-code-links" tooltip="Link to documentation for nilearn.image.mean_img"><span class="n">image</span><span class="o">.</span><span class="n">mean_img</span></a><span class="p">(</span><span class="n">registered_anats</span><span class="p">)</span>
<span class="n">display</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_anat.html#nilearn.plotting.plot_anat" class="sphx-glr-code-links" tooltip="Link to documentation for nilearn.plotting.plot_anat"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span></a><span class="p">(</span><span class="n">average_img</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;affine register&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">registered_anats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a href="http://nilearn.github.io/modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" class="sphx-glr-code-links" tooltip="Link to documentation for nilearn.plotting.show"><span class="n">plotting</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_register_001.png" class="align-center" src="../../_images/sphx_glr_plot_register_001.png" />
</div>
<div class="section" id="visualize-pipeline-steps">
<h2>Visualize pipeline steps<a class="headerlink" href="#visualize-pipeline-steps" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba.registration</span> <span class="kn">import</span> <a href="../../generated/sammba.registration.create_pipeline_graph.html#sammba.registration.create_pipeline_graph" class="sphx-glr-code-links" tooltip="Link to documentation for sammba.registration.create_pipeline_graph"><span class="n">create_pipeline_graph</span></a>

<span class="n">graph_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">write_dir</span><span class="p">,</span> <span class="s1">&#39;affine_registration_graph&#39;</span><span class="p">)</span>
<a href="../../generated/sammba.registration.create_pipeline_graph.html#sammba.registration.create_pipeline_graph" class="sphx-glr-code-links" tooltip="Link to documentation for sammba.registration.create_pipeline_graph"><span class="n">create_pipeline_graph</span></a><span class="p">(</span><span class="s1">&#39;anats_to_common_affine&#39;</span><span class="p">,</span> <span class="n">graph_file</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 6 minutes  29.227 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_register.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_register.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_register.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_register.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="http://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../02_preprocessing/plot_fmri_coregistration.html" class="btn btn-neutral float-right" title="Functional and anatomical coregistration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral" title="Gallery of Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, The sammba-MRI developers.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>