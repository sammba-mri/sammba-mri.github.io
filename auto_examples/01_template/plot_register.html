
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Sammba-MRI:Small mammals NeuroImaging in Python &#8212; Multimodal Imaging of Neurodegenerative Diseases and Therapies</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="6.2.1. Functional and anatomical coregistration" href="../02_preprocessing/plot_fmri_coregistration.html" />
    <link rel="prev" title="6. Gallery of Examples" href="../index.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="sammba-mri, neuroimaging, python, small animal, rodent, mouse, rat">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head><body>
<div id="logo-banner">
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="#">Template creation</a></big>
    </li>
    <li>
      <small><a href="../02_preprocessing/plot_fmri_coregistration.html">fMRI preprocessing</a></small>
    </li>
    <li>
      <a href="../../modules/reference.html#module-sammba.data_fetchers">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Sammba-MRI:</h1>
    <h2>Small mammals NeuroImaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../02_preprocessing/plot_fmri_coregistration.html" title="6.2.1. Functional and anatomical coregistration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="6. Gallery of Examples"
             accesskey="P">previous</a> |</li>
<li><a href="../../index.html">Sammba-MRI Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">6. Gallery of Examples</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">6.1.1. Registration to common space</a><ul>
<li><a class="reference internal" href="#retrieve-the-data">6.1.1.1. Retrieve the data</a></li>
<li><a class="reference internal" href="#define-the-writing-directory">6.1.1.2. Define the writing directory</a></li>
<li><a class="reference internal" href="#create-the-template">6.1.1.3. Create the template</a></li>
<li><a class="reference internal" href="#assess-the-template">6.1.1.4. Assess the template</a></li>
<li><a class="reference internal" href="#visalize-results">6.1.1.5. Visalize results</a></li>
<li><a class="reference internal" href="#visualize-pipeline-steps">6.1.1.6. Visualize pipeline steps</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">6. Gallery of Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../02_preprocessing/plot_fmri_coregistration.html"
                        title="next chapter">6.2.1. Functional and anatomical coregistration</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="registration-to-common-space">
<span id="sphx-glr-auto-examples-01-template-plot-register-py"></span><h1>6.1.1. Registration to common space<a class="headerlink" href="#registration-to-common-space" title="Permalink to this headline">¶</a></h1>
<p>Here we show how to create a template from multiple anatomical scans and
register all of them to it.
Initially, registration is of extracted brains. Once these are reasonably
aligned, whole heads are registered, weighted by masks that, if parameters
are chosen well, include some scalp. The amount of scalp is hopefully enough
to help in differentiating the brain-scalp boundary without including so much
head tissue that it starts to contaminate the registration with the highly
variable head tissue.</p>
<div class="section" id="retrieve-the-data">
<h2>6.1.1.1. Retrieve the data<a class="headerlink" href="#retrieve-the-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba</span> <span class="kn">import</span> <span class="n">data_fetchers</span>

<span class="n">lemur</span> <span class="o">=</span> <a href="../../generated/sammba.data_fetchers.fetch_lemur_mircen_2019_t2.html#sammba.data_fetchers.fetch_lemur_mircen_2019_t2" title="View documentation for sammba.data_fetchers.fetch_lemur_mircen_2019_t2"><span class="n">data_fetchers</span><span class="o">.</span><span class="n">fetch_lemur_mircen_2019_t2</span></a><span class="p">(</span><span class="n">subjects</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>retest contains paths to images and data description</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lemur</span><span class="o">.</span><span class="n">anat</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;/home/salma/nilearn_data/mircen2019_t2/sub-01/sub-01_anat_sub-01_T2w.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/nilearn_data/mircen2019_t2/sub-02/sub-02_anat_sub-02_T2w.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/nilearn_data/mircen2019_t2/sub-03/sub-03_anat_sub-03_T2w.nii.gz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="define-the-writing-directory">
<h2>6.1.1.2. Define the writing directory<a class="headerlink" href="#define-the-writing-directory" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">write_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;lemur_common&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">write_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">write_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-the-template">
<h2>6.1.1.3. Create the template<a class="headerlink" href="#create-the-template" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba.registration</span> <span class="kn">import</span> <a href="../../generated/sammba.registration.anats_to_common.html#sammba.registration.anats_to_common" title="View documentation for sammba.registration.anats_to_common"><span class="n">anats_to_common</span></a>

<span class="n">affine_register</span> <span class="o">=</span> <a href="../../generated/sammba.registration.anats_to_common.html#sammba.registration.anats_to_common" title="View documentation for sammba.registration.anats_to_common"><span class="n">anats_to_common</span></a><span class="p">(</span><span class="n">lemur</span><span class="o">.</span><span class="n">anat</span><span class="p">,</span> <span class="n">write_dir</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span>
                                  <span class="n">use_rats_tool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We set caching to True, so that the computations are not restarted.
The paths to the registered images can be accessed easilly</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">registered_anats</span> <span class="o">=</span> <span class="n">affine_register</span><span class="o">.</span><span class="n">registered</span>
<span class="nb">print</span><span class="p">(</span><span class="n">registered_anats</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/lemur_common/sub-01_anat_sub-01_T2w_0_Unifized_for_brain_extraction_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/lemur_common/sub-02_anat_sub-02_T2w_1_Unifized_for_brain_extraction_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/salma/CODE/sammba-mri/examples/01_template/lemur_common/sub-03_anat_sub-03_T2w_2_Unifized_for_brain_extraction_resample_shr_affine_catenated.nii.gz&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="assess-the-template">
<h2>6.1.1.4. Assess the template<a class="headerlink" href="#assess-the-template" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span>
<span class="n">template_img</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.mean_img.html#nilearn.image.mean_img" title="View documentation for nilearn.image.mean_img"><span class="n">image</span><span class="o">.</span><span class="n">mean_img</span></a><span class="p">(</span><span class="n">registered_anats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="visalize-results">
<h2>6.1.1.5. Visalize results<a class="headerlink" href="#visalize-results" title="Permalink to this headline">¶</a></h2>
<p>We plot the edges of one individual anat on top of the average image</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">plotting</span>

<span class="n">average_img</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.mean_img.html#nilearn.image.mean_img" title="View documentation for nilearn.image.mean_img"><span class="n">image</span><span class="o">.</span><span class="n">mean_img</span></a><span class="p">(</span><span class="n">registered_anats</span><span class="p">)</span>
<span class="n">display</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_anat.html#nilearn.plotting.plot_anat" title="View documentation for nilearn.plotting.plot_anat"><span class="n">plotting</span><span class="o">.</span><span class="n">plot_anat</span></a><span class="p">(</span><span class="n">average_img</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;affine register&#39;</span><span class="p">)</span>
<span class="n">display</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">registered_anats</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a href="http://nilearn.github.io/modules/generated/nilearn.plotting.show.html#nilearn.plotting.show" title="View documentation for nilearn.plotting.show"><span class="n">plotting</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_register_001.png" class="align-center" src="../../_images/sphx_glr_plot_register_001.png" />
</div>
<div class="section" id="visualize-pipeline-steps">
<h2>6.1.1.6. Visualize pipeline steps<a class="headerlink" href="#visualize-pipeline-steps" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba.graphs</span> <span class="kn">import</span> <a href="../../generated/sammba.graphs.create_pipeline_graph.html#sammba.graphs.create_pipeline_graph" title="View documentation for sammba.graphs.create_pipeline_graph"><span class="n">create_pipeline_graph</span></a>

<span class="n">graph_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">write_dir</span><span class="p">,</span> <span class="s1">&#39;affine_registration_graph&#39;</span><span class="p">)</span>
<a href="../../generated/sammba.graphs.create_pipeline_graph.html#sammba.graphs.create_pipeline_graph" title="View documentation for sammba.graphs.create_pipeline_graph"><span class="n">create_pipeline_graph</span></a><span class="p">(</span><span class="s1">&#39;anats_to_common_affine&#39;</span><span class="p">,</span> <span class="n">graph_file</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Total running time of the script:</strong> ( 51 minutes  0.667 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/983b353d71993e2a8aabc5be5e0991e2/plot_register.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_register.py</span></code></a></p>
</div>
<div class="sphx-glr-download docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fe5654178b99d928a7bdb373006b4255/plot_register.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_register.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; 2017, The sammba-MRI developers.
        <span style="padding-left: 5ex;">
          <a href="../../_sources/auto_examples/01_template/plot_register.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>