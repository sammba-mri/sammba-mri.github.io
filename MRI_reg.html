
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sammba-MRI:Small mammals NeuroImaging in Python &#8212; Multimodal Imaging of Neurodegenerative Diseases and Therapies</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4. Measuring regional brain volumes" href="Cereb_Atrophy.html" />
    <link rel="prev" title="2. Data conversion" href="dataorg.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="sammba-mri, neuroimaging, python, small animal, rodent, mouse, rat">


<script type="text/javascript">
function updateTopMenuPosition(height, width) {
    if($(window).scrollTop() > height && $(window).outerWidth() > 1024) {
        //begin to scroll
        $('.related-wrapper').css("z-index", 1000)
        $('.related-wrapper').css("position", "sticky")
        $('.related-wrapper').css("top", 0)
        $('.related-wrapper').css("width", width)
    } else {
        //lock it back into place
        $('.related-wrapper').css("position", "relative")
        $('.related-wrapper').css("top", 0)
    }
}

$(function() {
    var banner_height = $('#logo-banner').outerHeight()
    var banner_width = $('#logo-banner').outerWidth()
    var width = $('.related-wrapper').css("height", $('.related').outerHeight())

    updateTopMenuPosition(banner_height, width)

    $(window).scroll(function(event) {
        updateTopMenuPosition(banner_height, width)
    });

    $(window).resize(function(event) {
        var banner_width = $('#logo-banner').outerWidth()
        var menu_height = $('.related').outerHeight()
        $('.related').css("width", banner_width)
        $('.related-wrapper').css("height", menu_height)
        updateTopMenuPosition(banner_height, width)
    })
});
</script>
<script type="text/javascript">
function updateSideBarPosition(top, offset, sections) {
    var pos = $(window).scrollTop()
    // Lock the table of content to a fixed position once we scroll enough
    var topShift = 2 * offset
    if(pos > top + topShift + 1) {
        // begin to scroll with sticky menu bar
        var topShift = -topShift + 1
        if ($(window).outerWidth() < 1024) {
            // compensate top menu that disappears
            topShift -= offset + 1
        }
        $('.sphinxsidebarwrapper').css("position", "fixed")
        $('.sphinxsidebarwrapper').css("top", topShift)
    }
    else {
        //lock it back into place
        $('.sphinxsidebarwrapper').css("position", "relative")
        $('.sphinxsidebarwrapper').css("top",0)
    }

    // Highlight the current section
    i = 0
    current_section = 0
    $('a.internal').removeClass('active')
    for(i in sections) {
        if(sections[i] > pos) {
            break
        };
        if($('a.internal[href$="' + i + '"]').is(':visible')){
            current_section = i
        };
    }
    $('a.internal[href$="' + current_section + '"]').addClass('active')
    $('a.internal[href$="' + current_section + '"]').parent().addClass('active')
}

$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var tocOffset = $('.related-wrapper').outerHeight()
    var marginTop = parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0))
    var top = $('.sphinxsidebarwrapper').offset().top - marginTop
    sections = {}
    url = document.URL.replace(/#.*$/, "")

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50
    });

    updateSideBarPosition(top, tocOffset, sections)

    $(window).scroll(function(event) {
        updateSideBarPosition(top, tocOffset, sections)
    });

    $(window).resize(function(event) {
        tocOffset = $('.related-wrapper').outerHeight()
        updateSideBarPosition(top, tocOffset, sections)
    });
});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="auto_examples/01_template/plot_register.html">Template creation</a></big>
    </li>
    <li>
      <small><a href="auto_examples/02_preprocessing/plot_fmri_coregistration.html">fMRI preprocessing</a></small>
    </li>
    <li>
      <a href="modules/reference.html#module-sammba.data_fetchers">Datasets</a>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Sammba-MRI:</h1>
    <h2>Small mammals NeuroImaging in Python</h2>
  </div>
  <div class="search_form">
    <div class="gcse-search" id="cse" style="width: 100%;"></div>
    <script>
      (function() {
        var cx = '017289614950330089114:elrt9qoutrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
  </div>
</div>



<div class=related-wrapper>
    
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="Cereb_Atrophy.html" title="4. Measuring regional brain volumes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="dataorg.html" title="2. Data conversion"
             accesskey="P">previous</a> |</li>
<li><a href="index.html">Sammba-MRI Home</a> |&nbsp;</li>
<li><a href="user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="auto_examples/index.html">Examples</a> |&nbsp;</li>
<li><a href="reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="authors.html">About</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="user_guide.html" accesskey="U">User guide: table of contents</a> &#187;</li> 
      </ul>
    </div>
</div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

	   <div class="sidebartoc">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Registering several MRI images and creating a template</a><ul>
<li><a class="reference internal" href="#registering-several-raw-mri-images-to-common-space">3.1. Registering several raw MRI images to common space</a></li>
<li><a class="reference internal" href="#registering-several-mri-images-to-template-space">3.2. Registering several MRI images to template space</a></li>
</ul>
</li>
</ul>
</div>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dataorg.html"
                        title="previous chapter">2. Data conversion</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Cereb_Atrophy.html"
                        title="next chapter">4. Measuring regional brain volumes</a></p>

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="registering-several-mri-images-and-creating-a-template">
<h1>3. Registering several MRI images and creating a template<a class="headerlink" href="#registering-several-mri-images-and-creating-a-template" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first"><strong>Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#registering-several-raw-mri-images-to-common-space" id="id1">Registering several raw MRI images to common space</a></li>
<li><a class="reference internal" href="#registering-several-mri-images-to-template-space" id="id2">Registering several MRI images to template space</a></li>
</ul>
</div>
<div class="section" id="registering-several-raw-mri-images-to-common-space">
<h2><a class="toc-backref" href="#id1">3.1. Registering several raw MRI images to common space</a><a class="headerlink" href="#registering-several-raw-mri-images-to-common-space" title="Permalink to this headline">¶</a></h2>
<p>The <strong>anats_to_common</strong> pipeline implements the multi-level, iterative scheme
to create a fine anatomical template from individual anatomical MRI scans.
First, head images are centered on their respective brain mask centroid while
intensity biais corrected is performed. A first rough template is obtained by
rigid-body aligning extracted brain to a digitized version of a previous
histological atlas and applying the transform to the original heads.
Thereafter, sucessive averaging and registration process is iterated while
increasing the number of degrees of freedom of the estimated
transform. The target template updated at each step allowing the
creation of high quality templates.</p>
<blockquote>
<div><p>In sammba-MRI, you can call the function by typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba</span> <span class="k">import</span> <span class="n">registration</span>
<span class="n">anats_to_common</span><span class="p">(</span><span class="n">Images_to_register</span><span class="p">,</span> <span class="n">Saved_Registered_dir</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Note that most of registration steps relies on the freely available
<a class="reference external" href="https://afni.nimh.nih.gov/pub/dist/doc/htmldoc/background_install/main_toc.html">AFNI</a>
software.
For skull-stripping, the open source <a class="reference external" href="http://www.iibi.uiowa.edu/content/rats-overview/">RATS</a>
tool is also available by setting the parameter <code class="docutils literal"><span class="pre">use_rats_tool</span></code> to True.</p>
<p>An example of use this function is available called <em>Template creation</em></p>
</div>
<div class="section" id="registering-several-mri-images-to-template-space">
<h2><a class="toc-backref" href="#id2">3.2. Registering several MRI images to template space</a><a class="headerlink" href="#registering-several-mri-images-to-template-space" title="Permalink to this headline">¶</a></h2>
<p>Matching of individual MRI image to standard template is critical to perform
group-wise analysis. Multimodal images preprocessing can be performed in the
template space through the <em>TemplateRegistrator</em> class.
User can fit each anatomical images to a a set of modality (functional or
perfusion MRI). This <strong>ready-to-use</strong> pipelines align first the
functional or perfusion volume to the anatomical images through a rigid body
registration. Then, a per-slice basis registration is performed allowing
correction of EPI distortion. Finally, the rigid body transform and the
per-slice warps are combined and applied to the initial volume to minimize
interpolation errors.</p>
<blockquote>
<div><p>In sammba-MRI, the class can be call by typing</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sammba</span> <span class="k">import</span> <span class="n">registration</span>
<span class="n">registrator</span> <span class="o">=</span> <span class="n">TemplateRegistrator</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">brain_volume</span><span class="p">,</span> <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">registrator</span><span class="o">.</span><span class="n">fit_anat</span><span class="p">(</span><span class="n">anat_files</span><span class="p">)</span>
<span class="n">registrator</span><span class="o">.</span><span class="n">fit_modality</span><span class="p">(</span><span class="n">moadality_images</span><span class="p">,</span> <span class="n">name_of_the_modality</span>
</pre></div>
</div>
</div></blockquote>
<p>An example of use this function is available.</p>
<p>Note that TemplateRegistrator class encapsulate several functions
that are available as “stand-alone” in sammba-MRI:</p>
<ul>
<li><p class="first">anats_to_template : Allow to registering several MRI images to an existing template</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anats_to_template</span><span class="p">(</span><span class="n">images_to_register</span><span class="p">,</span> <span class="n">Template_name</span><span class="p">,</span> <span class="n">Saved_Registered_dir</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">caching</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">fmri_sessions_to_template : Allow to register several functional and anatomic MRI images to an existing template</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fmri_sessions_to_template</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">Atlas_name</span><span class="p">,</span><span class="n">Saved_Registered_dir</span><span class="p">,</span> <span class="n">maxlev</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">brain_volume</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">FMRISession : Encapsulate the data for performing registration of several functional MRI images to an existing template and EPI correction</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">FMRISession</span><span class="p">(</span><span class="n">Anats_to_register</span><span class="p">,</span> <span class="n">Funcs_to_register</span><span class="p">,</span> <span class="n">Saved_Registered_dir</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">coregister_fmri_session : process the data for performing registration of several functional MRI images to an existing template and EPI correction</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">coregister_fmri_session</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Saved_Registered_dir</span><span class="p">,</span> <span class="n">brain_volume</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">slice_timing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
            &copy; 2017, The sammba-MRI developers.
        <span style="padding-left: 5ex;">
          <a href="_sources/MRI_reg.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>